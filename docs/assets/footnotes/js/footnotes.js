(()=>{var t={251:()=>{var t=window.jQuery;window.CustomModalWorkflow=function(e){var o={},n=e.responses||{},r=e.onError||function(){};t(".custom-modal").remove();var i=document.createElement("div");i.classList.add("custom-modal"),o.wrapper=i,o.triggerElement=document.activeElement,o.triggerElement.setAttribute("disabled",!0);var a=t('<div class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">\n  <div class="modal-dialog">\n    <div class="modal-content">\n      <button type="button" class="button close button--icon text-replace" data-dismiss="modal"><svg class="icon icon-cross" aria-hidden="true" focusable="false"><use href="#icon-cross"></use></svg>'+wagtailConfig.STRINGS.CLOSE+'</button>\n      <div class="modal-body"></div>\n    </div>\x3c!-- /.modal-content --\x3e\n  </div>\x3c!-- /.modal-dialog --\x3e\n</div>');return t(i).append(a),t("body").append(i),a.modal("hide"),a.on("hide.bs.modal",(function(){o.triggerElement.removeAttribute("disabled")})),a.on("hidden.bs.modal",(function(){o.triggerElement.focus(),i.remove()})),o.body=a.find(".modal-body"),o.loadUrl=function(e,n){t.get(e,n,o.loadResponseText,"text").fail(r)},o.postForm=function(e,n){t.post(e,n,o.loadResponseText,"text").fail(r)},o.ajaxifyForm=function(e){t(e).each((function(){var e=this.action;"get"===this.method.toLowerCase()?t(this).on("submit",(function(){return o.loadUrl(e,t(this).serialize()),!1})):t(this).on("submit",(function(){return o.postForm(e,t(this).serialize()),!1}))}))},o.loadResponseText=function(t){var e=JSON.parse(t);o.loadBody(e)},o.loadBody=function(t){t.html&&(o.body.html(t.html),a.modal("show")),e.onload&&t.step&&t.step in e.onload&&e.onload[t.step](o,t)},o.respond=function(t){if(t in n){var e=Array.prototype.slice.call(arguments,1);n[t].apply(o,e)}},o.close=function(){a.modal("hide")},o.loadUrl(e.url,e.urlParams),o}},921:t=>{t.exports=function(t,e,o){for(var n=(2<<Math.log(e.length-1)/Math.LN2)-1,r=-~(1.6*n*o/e.length),i="";;)for(var a=t(r),s=r;s--;)if((i+=e[a[s]&n]||"").length===+o)return i}},703:(t,e,o)=>{"use strict";var n=o(414);function r(){}function i(){}i.resetWarningCache=r,t.exports=function(){function t(t,e,o,r,i,a){if(a!==n){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function e(){return t}t.isRequired=t;var o={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:i,resetWarningCache:r};return o.PropTypes=o,o}},697:(t,e,o)=>{t.exports=o(703)()},414:t=>{"use strict";t.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},670:(t,e,o)=>{"use strict";t.exports=o(607)},829:(t,e,o)=>{"use strict";var n,r,i,a=o(946),s="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-";function u(){i=!1}function c(t){if(t){if(t!==n){if(t.length!==s.length)throw new Error("Custom alphabet for shortid must be "+s.length+" unique characters. You submitted "+t.length+" characters: "+t);var e=t.split("").filter((function(t,e,o){return e!==o.lastIndexOf(t)}));if(e.length)throw new Error("Custom alphabet for shortid must be "+s.length+" unique characters. These characters were not unique: "+e.join(", "));n=t,u()}}else n!==s&&(n=s,u())}function l(){return i||(i=function(){n||c(s);for(var t,e=n.split(""),o=[],r=a.nextValue();e.length>0;)r=a.nextValue(),t=Math.floor(r*e.length),o.push(e.splice(t,1)[0]);return o.join("")}())}t.exports={get:function(){return n||s},characters:function(t){return c(t),n},seed:function(t){a.seed(t),r!==t&&(u(),r=t)},lookup:function(t){return l()[t]},shuffled:l}},480:(t,e,o)=>{"use strict";var n,r,i=o(416),a=(o(829),1567752802062);t.exports=function(t){var e="",o=Math.floor(.001*(Date.now()-a));return o===r?n++:(n=0,r=o),e+=i(7),e+=i(t),n>0&&(e+=i(n)),e+i(o)}},416:(t,e,o)=>{"use strict";var n=o(829),r=o(766),i=o(921);t.exports=function(t){for(var e,o=0,a="";!e;)a+=i(r,n.get(),1),e=t<Math.pow(16,o+1),o++;return a}},607:(t,e,o)=>{"use strict";var n=o(829),r=o(480),i=o(82),a=o(636)||0;function s(){return r(a)}t.exports=s,t.exports.generate=s,t.exports.seed=function(e){return n.seed(e),t.exports},t.exports.worker=function(e){return a=e,t.exports},t.exports.characters=function(t){return void 0!==t&&n.characters(t),n.shuffled()},t.exports.isValid=i},82:(t,e,o)=>{"use strict";var n=o(829);t.exports=function(t){return!(!t||"string"!=typeof t||t.length<6||new RegExp("[^"+n.get().replace(/[|\\{}()[\]^$+*?.-]/g,"\\$&")+"]").test(t))}},766:t=>{"use strict";var e,o="object"==typeof window&&(window.crypto||window.msCrypto);e=o&&o.getRandomValues?function(t){return o.getRandomValues(new Uint8Array(t))}:function(t){for(var e=[],o=0;o<t;o++)e.push(Math.floor(256*Math.random()));return e},t.exports=e},946:t=>{"use strict";var e=1;t.exports={nextValue:function(){return(e=(9301*e+49297)%233280)/233280},seed:function(t){e=t}}},636:t=>{"use strict";t.exports=0}},e={};function o(n){var r=e[n];if(void 0!==r)return r.exports;var i=e[n]={exports:{}};return t[n](i,i.exports,o),i.exports}o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";o(251);var t=o(697),e=o.n(t);function n(){return n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}return t},n.apply(this,arguments)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e,o){return e&&i(t.prototype,e),o&&i(t,o),t}function s(t,e){return s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},s(t,e)}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}function c(t){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(t)}function l(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function f(t,e){return!e||"object"!==c(e)&&"function"!=typeof e?l(t):e}function p(t){return p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},p(t)}var d=window.React.Component,h=window.wagtail.components.Icon,y=window.draftail.TooltipEntity,v=React.createElement(h,{name:"asterisk",className:"asterisk"}),m=o(670),w=window.jQuery;window.footnoteUUIDList=window.footnoteUUIDList||{};var g=function(t){u(s,t);var e,o,i=(e=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,n=p(e);if(o){var r=p(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return f(this,t)});function s(t){var e;r(this,s);var o=(e=i.call(this,t)).props;return o.contentState,o.entityKey,e}return a(s,[{key:"render",value:function(){var t=this.props,e=t.contentState,o=t.entityKey,r=this.props.getEditorState().getLastChangeType();this.props.children="";var i=e.getEntity(o).getData();return function(t,e,o,n){var r=n.uuid;"insert-fragment"===t?r=function(t,e){var o;return void 0===window.footnoteUUIDList[e]?o=e:window.footnoteUUIDList[e]!==t?o=m.generate():window.footnoteUUIDList[e]===t&&(o=e),window.footnoteUUIDList[o]=t,o}(o,n.uuid):window.footnoteUUIDList[r]=o,e.replaceEntityData(o,{text:n.text,uuid:r})}(r,e,o,i),w(".Tooltip.Tooltip--top").hide(),React.createElement("span",{role:"button",className:"FootnoteEntity"},React.createElement(y,n({},this.props,function(t){return{icon:v,label:t.text?t.text.replace(/<[^>]+>/g,""):null}}(i))))}}]),s}(d);g.propTypes={entityKey:e().string.isRequired,children:e().node.isRequired};var b=function(t){return React.createElement(g,t)};b.propTypes={entityKey:e().string.isRequired,contentState:e().object.isRequired};const x=b;var R={chooser:function(t,e){$("form.footnote-form",t.body).on("submit",(function(){var e=new FormData(this);return $.ajax({url:this.action,data:e,processData:!1,contentType:!1,type:"POST",dataType:"text",success:t.loadResponseText}),!1}))},footnote_chosen:function(t,e){t.respond("footnoteChosen",e.footnote_data),t.close()}};var T=window.React.Component,E=window.DraftJS.Modifier,O=window.DraftJS.RichUtils,C=window.DraftJS.EditorState,S=o(670),j=window.jQuery,k=window.wagtailConfig.STRINGS.STRINGS,U="FOOTNOTE",P={};P[U]="IMMUTABLE";var _=function(t){u(s,t);var e,n,i=(e=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,o=p(e);if(n){var r=p(this).constructor;t=Reflect.construct(o,arguments,r)}else t=o.apply(this,arguments);return f(this,t)});function s(t){var e;return r(this,s),(e=i.call(this,t)).onChosen=e.onChosen.bind(l(e)),e.onClose=e.onClose.bind(l(e)),e}return a(s,[{key:"componentDidMount",value:function(){var t=this,e=this.props,n=e.onClose,r=function(t,e,o){var n;if(t.type===U){if(n={text:o,uuid:S.generate()},e){var r=e.getData();r.text&&(n.text=r.text),r.uuid&&(n.uuid=r.uuid)}return{url:"/admin/footnotes/chooser/",urlParams:n,onload:R}}return{url:null,urlParams:{},onload:{}}}(e.entityType,e.entity,function(t){var e=t.getSelection(),o=e.getAnchorOffset(),n=e.getFocusOffset(),r=function(t){var e=t.getSelection(),o=t.getCurrentContent(),n=e.getStartKey(),r=e.getEndKey(),i=o.getBlockMap();return i.toSeq().skipUntil((function(t,e){return e===n})).takeUntil((function(t,e){return e===r})).concat([[r,i.get(r)]]).toList()}(t);if(e.getIsBackward()){var i=o;o=n,n=i}for(var a="",s=0;s<r.size;s+=1){var u=0===s?o:0,c=s===r.size-1?n:r.get(s).getText().length;a+=r.get(s).getText().slice(u,c)}return a}(e.editorState)),i=r.url,a=r.urlParams,s=r.onload;this.workflow=o.g.CustomModalWorkflow({url:i,urlParams:a,onload:s,responses:{footnoteChosen:function(e){return t.onChosen(e)}},onError:function(){window.alert(k.SERVER_ERROR),n()}}),j(this.workflow.wrapper).on("hidden.bs.modal",this.onClose)}},{key:"componentWillUnmount",value:function(){j(this.workflow.wrapper).off("hidden.bs.modal",this.onClose),this.workflow=null}},{key:"onChosen",value:function(t){var e,o=this.props,n=o.editorState,r=o.entityType,i=o.onComplete,a=n.getCurrentContent(),s=n.getSelection(),u=function(t,e){return t.type===U?{text:e.text,uuid:e.uuid}:{}}(r,t),c=P[r.type],l=a.createEntity(r.type,c,u).getLastCreatedEntityKey();if(t.text||s.isCollapsed()){var f=t.text,p=E.replaceText(a,s,f,null,l);e=C.push(n,p,"insert-characters")}else e=O.toggleLink(n,s,l);this.workflow.close(),i(e)}},{key:"onClose",value:function(t){var e=this.props.onClose;t.preventDefault(),e()}},{key:"render",value:function(){return null}}]),s}(T);_.propTypes={editorState:e().object.isRequired,entityType:e().object.isRequired,entity:e().object,onComplete:e().func.isRequired,onClose:e().func.isRequired},_.defaultProps={entity:null};const D=_;var I=window.draftail;[{type:"FOOTNOTE",source:D,decorator:x}].forEach(I.registerPlugin)})()})();